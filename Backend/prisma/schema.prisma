// Prisma Schema for AI Outreach Platform
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Recruiter Model
model Recruiter {
  id            String    @id @default(uuid())
  name          String
  email         String    @unique
  company       String?
  jobTitle      String?
  linkedIn      String?
  country       String?
  field         String?   // e.g., "Technology", "Finance", "Healthcare"
  status        String    @default("active") // active, inactive, bounced
  scrapedAt     DateTime  @default(now())
  enrichedData  Json?     // Additional AI-enriched data
  
  // Relations
  campaigns     CampaignRecipient[]
  meetings      Meeting[] @relation("RecruiterMeetings")
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([email])
  @@index([country, field])
  @@index([status])
}

// Student Model
model Student {
  id                String    @id @default(uuid())
  name              String
  email             String    @unique
  phone             String?
  university        String?
  major             String?
  graduationYear    Int?
  country           String?
  linkedIn          String?
  resume            String?   // URL or path to resume
  status            String    @default("waitlist") // waitlist, contacted, scheduled, completed
  waitlistJoinedAt  DateTime  @default(now())
  
  // Relations
  campaigns         CampaignRecipient[]
  meetings          Meeting[] @relation("StudentMeetings")
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([email])
  @@index([status])
  @@index([country])
}

// Email Campaign Model
model Campaign {
  id              String    @id @default(uuid())
  name            String
  targetAudience  String    // "recruiters", "students", "both"
  subject         String
  template        String    @db.Text
  status          String    @default("draft") // draft, scheduled, sending, completed, paused
  scheduledAt     DateTime?
  completedAt     DateTime?
  
  // Analytics
  totalRecipients Int       @default(0)
  sentCount       Int       @default(0)
  deliveredCount  Int       @default(0)
  openedCount     Int       @default(0)
  clickedCount    Int       @default(0)
  bouncedCount    Int       @default(0)
  
  // Relations
  recipients      CampaignRecipient[]
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([status])
  @@index([scheduledAt])
}

// Campaign Recipients (many-to-many with tracking)
model CampaignRecipient {
  id            String    @id @default(uuid())
  campaignId    String
  recipientType String    // "recruiter" or "student"
  recruiterId   String?
  studentId     String?
  
  // Email tracking
  personalizedContent String? @db.Text
  sentAt        DateTime?
  deliveredAt   DateTime?
  openedAt      DateTime?
  clickedAt     DateTime?
  bouncedAt     DateTime?
  status        String    @default("pending") // pending, sent, delivered, opened, clicked, bounced, failed
  
  // Relations
  campaign      Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  recruiter     Recruiter? @relation(fields: [recruiterId], references: [id], onDelete: Cascade)
  student       Student?   @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  
  @@index([campaignId])
  @@index([status])
  @@index([recruiterId])
  @@index([studentId])
}

// Meeting Model
model Meeting {
  id                String    @id @default(uuid())
  recruiterId       String
  studentId         String
  
  title             String
  description       String?   @db.Text
  scheduledTime     DateTime
  duration          Int       @default(30) // in minutes
  timezone          String    @default("America/New_York")
  
  // Google Calendar
  googleMeetLink    String?
  calendarEventId   String?   @unique
  
  // Status tracking
  status            String    @default("scheduled") // scheduled, confirmed, completed, cancelled, no-show
  confirmationSent  Boolean   @default(false)
  reminderSent      Boolean   @default(false)
  
  // Relations
  recruiter         Recruiter @relation("RecruiterMeetings", fields: [recruiterId], references: [id], onDelete: Cascade)
  student           Student   @relation("StudentMeetings", fields: [studentId], references: [id], onDelete: Cascade)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([recruiterId])
  @@index([studentId])
  @@index([scheduledTime])
  @@index([status])
}

// Scraping Log Model
model ScrapingLog {
  id            String    @id @default(uuid())
  jobType       String    // "recruiter", "student"
  target        String    // URL or platform being scraped
  status        String    @default("running") // running, completed, failed, cancelled
  recordsFound  Int       @default(0)
  recordsSaved  Int       @default(0)
  errors        Json?     // Error logs
  
  startedAt     DateTime  @default(now())
  completedAt   DateTime?
  
  createdAt     DateTime  @default(now())
  
  @@index([jobType])
  @@index([status])
  @@index([startedAt])
}

// Admin User Model (for dashboard access)
model Admin {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  name          String
  role          String    @default("admin") // admin, super_admin
  isActive      Boolean   @default(true)
  
  lastLoginAt   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([email])
}
